version: '2'
services:
  builder:
    container_name: "Connected_Builder"
    privileged: true
    env_file: 
      - devcontainer.env 
      - branch.env
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - vscodeWorkspace:/home/vscode/workspace:cached
      - vscodeExt:/home/vscode/.vscode-server/extensions
      - vscodeinsidersExt:/home/vscode/.vscode-server-insiders/extensions
  runner:
    container_name: "Isolated_Runner"
    privileged: true
    depends_on:
      - builder
    env_file: 
      - devcontainer.env
    network_mode: "none"
    build:
      context: .
      dockerfile: Dockerfile
      network: none
    volumes:
      - vscodeWorkspace:/home/vscode/workspace:cached
      - vscodeExt:/home/vscode/.vscode-server/extensions
      - vscodeinsidersExt:/home/vscode/.vscode-server-insiders/extensions
    cap_add:
      - SYS_PTRACE
    security_opt:
      - seccomp:unconfined
volumes:
  vscodeWorkspace:
  vscodeExt:
  vscodeinsidersExt:
